<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>دليل - Daleel | دليل الخدمات الحكومية والعامة</title>
    <meta name="description" content="دليل شامل للخدمات الحكومية والعامة مع تقييمات المستخدمين والمعلومات المفصلة"/>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Meta Tags for Social Media Sharing -->
    <meta property="og:title" content="دليل - Daleel | دليل الخدمات الحكومية والعامة">
    <meta property="og:description" content="دليل شامل للخدمات الحكومية - منصة تفاعلية لمشاركة التجارب وتسهيل الوصول للخدمات العامة">
    <meta property="og:image" content="https://raw.githubusercontent.com/rawad-store/daleel/main/preview.jpg">
    <meta property="og:url" content="https://rawad-store.github.io/Daleel/">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="دليل - Daleel | دليل الخدمات الحكومية والعامة">
    <meta name="twitter:description" content="دليل شامل للخدمات الحكومية - منصة تفاعلية لمشاركة التجارب وتسهيل الوصول للخدمات العامة">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/rawad-store/daleel/main/preview.jpg">
    
    <style>
        /* أنماط CSS تبقى كما هي */
        :root {
            --primary: #2D5F7C;
            --secondary: #4A90E2;
            --accent: #F5A623;
            --text: #333;
            --bg: #F8F9FA;
            --white: #fff;
            --border: #E0E0E0;
            --shadow: 0 2px 12px rgba(0,0,0,.08);
            --success: #27AE60;
            --error: #E74C3C;
            --primary-color: #2D5F7C;
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        
        a {
            color: inherit;
            text-decoration: none;
            transition: var(--transition);
        }
        
        a:hover {
            opacity: 0.8;
        }
        
        header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: var(--white);
            box-shadow: var(--shadow);
        }
        
        .nav {
            max-width: 1200px;
            margin: auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
        }
        
        .brand {
            display: flex;
            gap: 10px;
            align-items: center;
            font-weight: 700;
            color: var(--primary);
        }
        
        .actions {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            border: none;
            border-radius: 8px;
            padding: .65rem 1rem;
            cursor: pointer;
            font-family: inherit;
            transition: var(--transition);
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-danger {
            background: var(--error);
            color: var(--white);
        }
        
        .btn-warning {
            background: #f39c12;
            color: var(--white);
        }
        
        .btn-icon {
            display: inline-flex;
            gap: .45rem;
            align-items: center;
        }
        
        .hero {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 40px 0;
            transition: var(--transition);
        }
        
        .hero .wrap {
            max-width: 1200px;
            margin: auto;
            padding: 0 16px;
            display: grid;
            gap: 16px;
        }
        
        .hero h1 {
            margin: 0 0 10px;
            font-size: 2.2rem;
        }
        
        .stats {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(255,255,255,.12);
            border: 1px solid rgba(255,255,255,.25);
            padding: 12px 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }
        
        .stat:hover {
            transform: scale(1.05);
        }
        
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 24px 16px;
        }
        
        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto 20px;
        }
        
        .search-bar {
            display: flex;
            width: 100%;
        }
        
        .search-bar input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px 0 0 8px;
            font-family: inherit;
            outline: none;
            transition: var(--transition);
        }
        
        .search-bar input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 5px var(--primary);
        }
        
        .search-bar button {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0 20px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            transition: var(--transition);
        }
        
        .search-suggestion {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }
        
        .search-suggestion:hover {
            background-color: #f5f5f5;
        }
        
        /* قائمة التصنيفات الأفقية */
        .horizontal-filters {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 15px 0;
            margin: 15px auto 20px;
            max-width: 600px;
            scrollbar-width: thin;
        }
        
        .horizontal-filters::-webkit-scrollbar {
            height: 6px;
        }
        
        .horizontal-filters::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 14px;
            font-family: 'Cairo', sans-serif;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--white);
            border-radius: 14px;
            box-shadow: var(--shadow);
            padding: 14px;
            position: relative;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            font-size: .9rem;
            color: #555;
            margin: .5rem 0;
        }
        
        .rating {
            display: flex;
            gap: 3px;
            margin: 8px 0;
            color: #FFC107;
        }

        .rating i {
            font-size: 1.2rem; /* تحسين حجم النجوم */
        }
        
        .reviews {
            margin-top: 10px;
            border-top: 1px solid var(--border);
            padding-top: 10px;
        }
        
        .review-item {
            background: #f9f9f9;
            padding: 15px; /* زيادة الحشو */
            border-radius: 8px;
            margin-bottom: 15px; /* زيادة المسافة بين التقييمات */
            transition: var(--transition);
            border: 1px solid var(--border); /* إضافة حدود */
        }

        .review-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); /* تأثير hover */
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px; /* زيادة المسافة */
            font-size: 0.95rem; /* تحسين حجم الخط */
            color: #444; /* لون أغمق قليلاً */
        }
        
        .review-header div:first-child {
            font-weight: 600; /* جعل اسم المستخدم bold */
        }

        .review-accuracy {
            margin-top: 5px;
            font-style: italic; /* إضافة نمط لدقة المعلومات */
            color: #666;
        }

        .review-comment {
            margin-top: 10px;
            border-top: 1px dashed var(--border); /* خط فاصل منقط */
            padding-top: 10px;
            font-size: 0.95rem;
        }
        
        .empty {
            padding: 48px;
            text-align: center;
            color: #777;
            grid-column: 1 / -1;
        }
        
        .search-results-info {
            margin-bottom: 20px;
            text-align: center;
            color: #555;
        }
        
        .modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,.5);
            z-index: 100;
            padding: 16px;
            transition: var(--transition);
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .box {
            background: var(--white);
            border-radius: 14px;
            max-width: 520px;
            width: 100%;
            box-shadow: var(--shadow);
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
            animation: scaleIn 0.3s ease;
            -webkit-overflow-scrolling: touch;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .box-header {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .box-body {
            padding: 16px 18px;
        }
        
        .row {
            display: grid;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .row-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        label {
            font-weight: 600;
            color: var(--primary);
        }
        
        input, select, textarea {
            width: 100%;
            padding: .7rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            outline: none;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 5px var(--primary);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .f-end {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 10px;
        }
        
        .toast-wrap {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 200;
        }
        
        .toast {
            background: var(--primary);
            color: var(--white);
            padding: .8rem 1rem;
            border-radius: 8px;
            margin-bottom: 8px;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s ease;
            transition: var(--transition);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast.error {
            background: var(--error);
        }
        
        .toast.success {
            background: var(--success);
        }
        
        .contact-info {
            background: var(--white);
            padding: 20px;
            border-radius: 14px;
            box-shadow: var(--shadow);
            margin-top: 30px;
            text-align: center;
            transition: var(--transition);
        }
        
        .contact-info:hover {
            transform: translateY(-5px);
        }
        
        .contact-info h3 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .contact-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .contact-link {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--text);
            transition: var(--transition);
        }
        
        .contact-link:hover {
            color: var(--primary);
        }
        
        footer {
            background: var(--primary);
            color: var(--white);
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }
        
        .social-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-card {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .social-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* أنماط نافذة الترحيب */
        #welcomeModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.75);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Cairo', sans-serif;
        }
        
        .welcome-section {
            text-align: center;
            padding: 3rem 1rem;
            background: #f9f9f9;
        }
        
        .welcome-content {
            max-width: 750px;
            margin: auto;
        }
        
        .welcome-content h2 {
            color: #27ae60;
            font-size: 2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .welcome-content p {
            color: #34495e;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .btn-start {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: #fff;
            border: none;
            padding: 14px 35px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 14px rgba(0,0,0,0.25);
        }
        
        .fadeItem {
            transition: opacity 0.8s ease, transform 0.8s ease;
            transform: translateY(20px);
            opacity: 0;
        }
        
        .fadeItem.show {
            opacity: 1 !important;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .row-2 {
                grid-template-columns: 1fr;
            }
            
            .stats {
                justify-content: center;
            }
            
            .contact-links {
                flex-direction: column;
                align-items: center;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .card-actions {
                flex-direction: column;
            }
            
            .horizontal-filters {
                gap: 8px;
            }
            
            .filter-btn {
                padding: 8px 16px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 480px) {
            .nav {
                flex-direction: column;
                gap: 10px;
            }
            
            .hero h1 {
                font-size: 1.5rem;
            }
            
            .stat {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }
        
        /* تحسينات للبطاقات وأزرار الإجراءات */
        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .card-action-btn {
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        
        /* تعديل عرض التقييمات لتكون رأسية ومتجاوبة */
        #reviewsList {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        
        .review-item {
            width: 100%;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .review-item {
                padding: 12px; /* تقليل الحشو على الشاشات الصغيرة */
            }
            
            .review-header {
                flex-direction: column; /* جعل الرأس رأسياً على الشاشات الصغيرة */
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="nav" role="navigation" aria-label="التنقل الرئيسي">
            <div class="brand">📍 دليل <span style="font-weight:400;color:#777">| دليلك للخدمات</span></div>
            <div class="actions">
                <button id="addServiceNav" class="btn btn-primary btn-icon" style="display:none" onclick="toggleAdd()" aria-label="إضافة خدمة جديدة">➕ أضف خدمة عملتها</button>
                <button id="loginBtn" class="btn btn-outline btn-icon" onclick="openAuth('login')" aria-label="تسجيل الدخول">دخول</button>
                <button id="registerBtn" class="btn btn-primary btn-icon" onclick="openAuth('register')" aria-label="إنشاء حساب">تسجيل</button>
                <button id="logoutBtn" class="btn btn-outline btn-icon" style="display:none" onclick="logout()" aria-label="تسجيل الخروج">خروج</button>
            </div>
        </nav>
    </header>
    
    <!-- Hero Section -->
    <section class="hero" aria-labelledby="hero-title">
        <div class="wrap">
            <div>
                <h1 id="hero-title">دليلك الشامل للخدمات الحكومية والعامة</h1>
                <p style="opacity:.9">استكشف الخدمات وشارك تجربتك مع الآخرين</p>
            </div>
            <div class="stats">
                <div class="stat" aria-live="polite"><b id="statServices">0</b> خدمة</div>
                <div class="stat" aria-live="polite"><b id="statUsers">0</b> مستخدم</div>
                <div class="stat" aria-live="polite"><b id="statReviews">0</b> تقييم</div>
                <div class="stat"><button id="addServiceTop" class="btn btn-primary btn-icon" style="display:none" onclick="toggleAdd()" aria-label="إضافة خدمة جديدة">➕ أضف خدمة عملتها</button></div>
            </div>
        </div>
    </section>
    
    <!-- Main Content -->
    <main class="container" aria-label="المحتوى الرئيسي">
        <!-- Search Section -->
        <section class="search-container" aria-label="بحث عن الخدمات">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="ابحث عن خدمة (يمكنك البحث بأي جزء من الكلمة أو عدة كلمات)..." aria-label="حقل البحث" />
                <button onclick="searchServices()" aria-label="بحث"><i class="fas fa-search"></i></button>
            </div>
            <div id="searchSuggestions" class="search-suggestions" role="listbox" aria-label="اقتراحات البحث"></div>
            
            <!-- قائمة التصنيفات الأفقية -->
            <div class="horizontal-filters">
                <button class="filter-btn active" data-category="الكل" onclick="filterByCategory('الكل')">الكل</button>
                <button class="filter-btn" data-category="حكومي" onclick="filterByCategory('حكومي')">حكومي</button>
                <button class="filter-btn" data-category="صحة" onclick="filterByCategory('صحة')">صحة</button>
                <button class="filter-btn" data-category="تعليم" onclick="filterByCategory('تعليم')">تعليم</button>
                <button class="filter-btn" data-category="مالي" onclick="filterByCategory('مالي')">مالي</button>
                <button class="filter-btn" data-category="أخرى" onclick="filterByCategory('أخرى')">أخرى</button>
            </div>
        </section>
        
        <div id="searchResultsInfo" class="search-results-info" aria-live="polite"></div>
        
        <!-- Services Section -->
        <section id="services" class="grid" aria-label="قائمة الخدمات"></section>
        <div id="empty" class="empty">لا توجد خدمات حالياً — كن أول من يضيف خدمة ✨</div>
        
        <!-- Contact Section -->
        <section class="contact-info" aria-label="معلومات الاتصال">
            <h3>للتواصل معنا</h3>
            <p>يسعدنا تواصلكم معنا لأي استفسارات أو مقترحات</p>
            <div class="contact-links">
                <a href="mailto:tarek500500@gmail.com" class="contact-link" aria-label="البريد الإلكتروني">
                    <i class="fas fa-envelope"></i> tarek500500@gmail.com
                </a>
                <a href="https://wa.me/+201126630356?text=مرحباً، أريد الاستفسار عن خدماتكم" class="contact-link" target="_blank" rel="noopener noreferrer" aria-label="واتساب">
                    <i class="fab fa-whatsapp"></i> واتساب
                </a>
            </div>
        </section>
        
        <section style="text-align: center; margin-top: 30px;" aria-label="وسائل التواصل الاجتماعي">
            <h4 style="margin-bottom: 1.5rem; color: var(--primary-color); font-size: 1.3rem; font-weight: 600;">تابعونا على وسائل التواصل الاجتماعي</h4>
            <div class="social-grid">
                <a href="https://www.facebook.com/share/1FzKsPMMsG/" class="social-card" target="_blank" rel="noopener noreferrer" style="background-color: #1877f2; color: #fff; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;" aria-label="فيسبوك">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://rawad-store.github.io/konozalkhair/" class="social-card" target="_blank" rel="noopener noreferrer" style="background-color: #e63946; color: #fff; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;" aria-label="مؤسسة كنوز الخير">
                    <i class="fas fa-hand-holding-heart"></i>
                </a>
                <a href="https://www.facebook.com/share/18bfjxRbHH" class="social-card" target="_blank" rel="noopener noreferrer" style="background-color: #1877f2; color: #fff; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;" aria-label="فيسبوك">
                    <i class="fab fa-facebook-f"></i>
                </a>    
                <a href="https://rawad-store.github.io/" class="social-card" target="_blank" rel="noopener noreferrer" style="background-color: #2a9d8f; color: #fff; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;" aria-label="مكتبة رواد ستور">
                    <i class="fas fa-book"></i>
                </a>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer aria-label="تذييل الصفحة">
        <p>© 2025 دليل - Daleel. جميع الحقوق محفوظة لمكتبة الرواد بالصوة</p>
    </footer>
    
    <!-- Add Service Modal -->
    <div id="addModal" class="modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="box" aria-modal="true" aria-labelledby="addModalTitle">
            <div class="box-header">
                <h3 style="margin:0" id="addModalTitle">إضافة خدمة جديدة</h3>
                <button class="btn btn-outline" onclick="toggleAdd()">إغلاق</button>
            </div>
            <form id="serviceForm" class="box-body">
                <input type="hidden" id="editServiceId" value="">
                <div class="row">
                    <label for="svcName">اسم الخدمة</label>
                    <input id="svcName" placeholder="مثال: استخراج جواز سفر" required aria-required="true" />
                </div>
                <div class="row row-2">
                    <div>
                        <label for="svcCat">القسم</label>
                        <select id="svcCat" required aria-required="true">
                            <option value="">اختر القسم</option>
                            <option>حكومي</option>
                            <option>صحة</option>
                            <option>تعليم</option>
                            <option>مالي</option>
                            <option>أخرى</option>
                        </select>
                    </div>
                    <div>
                        <label for="svcLoc">المكان</label>
                        <input id="svcLoc" placeholder="الشرقية - أبوحماد" required aria-required="true" />
                    </div>
                </div>
                <div class="row">
                    <label for="svcDocs">الأوراق المطلوبة</label>
                    <textarea id="svcDocs" placeholder="اذكر الأوراق المطلوبة..." required aria-required="true"></textarea>
                </div>
                <div class="row row-2">
                    <div>
                        <label for="svcCost">التكلفة (اختياري)</label>
                        <input id="svcCost" placeholder="مثال: 100 جنيه"/>
                    </div>
                    <div>
                        <label for="svcDur">المدة المتوقعة (اختياري)</label>
                        <input id="svcDur" placeholder="مثال: 3-5 أيام"/>
                    </div>
                </div>
                <div class="row">
                    <label for="svcNotes">ملاحظات (اختياري)</label>
                    <textarea id="svcNotes" placeholder="أي معلومات إضافية مفيدة..."></textarea>
                </div>
                <div class="f-end">
                    <button type="button" class="btn" onclick="toggleAdd()" aria-label="إلغاء">إلغاء</button>
                    <button type="submit" class="btn btn-primary btn-icon" id="serviceFormSubmit" aria-label="حفظ الخدمة">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Review Modal -->
    <div id="reviewModal" class="modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="box" aria-modal="true" aria-labelledby="reviewServiceName">
            <div class="box-header">
                <h3 style="margin:0">تقييم الخدمة: <span id="reviewServiceName"></span></h3>
                <button class="btn btn-outline" onclick="closeReview()" aria-label="إغلاق النافذة">إغلاق</button>
            </div>
            <div class="box-body">
                <form id="reviewForm">
                    <div class="row">
                        <label>التقييم</label>
                        <div class="rating" id="ratingStars" role="radiogroup" aria-label="اختيار التقييم">
                            <i class="far fa-star" data-rating="1" role="radio" aria-checked="false" tabindex="0"></i>
                            <i class="far fa-star" data-rating="2" role="radio" aria-checked="false" tabindex="-1"></i>
                            <i class="far fa-star" data-rating="3" role="radio" aria-checked="false" tabindex="-1"></i>
                            <i class="far fa-star" data-rating="4" role="radio" aria-checked="false" tabindex="-1"></i>
                            <i class="far fa-star" data-rating="5" role="radio" aria-checked="false" tabindex="-1"></i>
                        </div>
                        <input type="hidden" id="reviewRating" value="0" required aria-required="true" />
                    </div>
                    <div class="row">
                        <label for="reviewComment">التعليق (اختياري)</label>
                        <textarea id="reviewComment" placeholder="اكتب تعليقك عن الخدمة..."></textarea>
                    </div>
                    <div class="row">
                        <label for="reviewAccuracy">هل المعلومات صحيحة?</label>
                        <select id="reviewAccuracy" required aria-required="true">
                            <option value="">اختر الإجابة</option>
                            <option value="نعم">نعم، المعلومات صحيحة</option>
                            <option value="جزئياً">جزئياً، بعض المعلومات تحتاج تحديث</option>
                            <option value="لا">لا، المعلومات غير صحيحة</option>
                        </select>
                    </div>
                    <div class="f-end">
                        <button type="button" class="btn" onclick="closeReview()" aria-label="إلغاء">إلغاء</button>
                        <button type="submit" class="btn btn-primary btn-icon" aria-label="حفظ التقييم">💾 حفظ التقييم</button>
                    </div>
                </form>
                
                <section class="reviews" id="serviceReviews" aria-label="التقييمات السابقة">
                    <h4>التقييمات السابقة</h4>
                    <div id="reviewsList" class="loading" aria-live="polite"><i class="fas fa-spinner fa-spin"></i> جاري التحميل...</div>
                </section>
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div id="authModal" class="modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="box" aria-modal="true" aria-labelledby="authTitle">
            <div class="box-header">
                <h3 id="authTitle" style="margin:0">تسجيل الدخول</h3>
                <button class="btn btn-outline" onclick="closeAuth()" aria-label="إغلاق النافذة">إغلاق</button>
            </div>
            <div class="box-body">
                <!-- Login -->
                <form id="loginForm" class="row" autocomplete="on">
                    <div class="row">
                        <label for="loginEmail">البريد الإلكتروني</label>
                        <input type="email" id="loginEmail" placeholder="example@example.com" required aria-required="true" autocomplete="email" />
                    </div>
                    <div class="row">
                        <label for="loginPassword">كلمة المرور</label>
                        <input type="password" id="loginPassword" placeholder="********" required aria-required="true" autocomplete="current-password" />
                    </div>
                    <div class="f-end">
                        <button type="button" class="btn" onclick="closeAuth()" aria-label="إلغاء">إلغاء</button>
                        <button type="submit" class="btn btn-primary btn-icon" aria-label="تسجيل الدخول">🔐 تسجيل الدخول</button>
                    </div>
                </form>
                
                <!-- Register -->
                <form id="registerForm" class="row" style="display:none" autocomplete="on">
                    <div class="row">
                        <label for="registerName">الاسم</label>
                        <input type="text" id="registerName" placeholder="الاسم الكامل" required aria-required="true" autocomplete="name" />
                    </div>
                    <div class="row">
                        <label for="registerEmail">البريد الإلكتروني</label>
                        <input type="email" id="registerEmail" placeholder="example@example.com" required aria-required="true" autocomplete="email" />
                    </div>
                    <div class="row">
                        <label for="registerPassword">كلمة المرور (6 أحرف على الأقل)</label>
                        <input type="password" id="registerPassword" placeholder="********" minlength="6" required aria-required="true" autocomplete="new-password" />
                    </div>
                    <div class="f-end">
                        <button type="button" class="btn" onclick="closeAuth()" aria-label="إلغاء">إلغاء</button>
                        <button type="submit" class="btn btn-primary btn-icon" aria-label="إنشاء حساب">👤 إنشاء حساب</button>
                    </div>
                </form>
                
                <div style="text-align:center; margin-top:20px">
                    <button id="toggleAuthBtn" class="btn btn-outline" onclick="toggleAuthForm()" aria-label="التبديل بين تسجيل الدخول وإنشاء حساب">ليس لديك حساب؟ إنشاء حساب</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div id="toastWrap" class="toast-wrap" role="status" aria-live="polite"></div>
    
    <!-- Welcome Modal -->
    <div id="welcomeModal" style="display: flex;">
        <div class="welcome-content">
            <h2 class="fadeItem" style="opacity: 0;">مرحباً بك في دليل الخدمات!</h2>
            <p class="fadeItem" style="opacity: 0;">منصة تفاعلية تهدف لتسهيل الوصول للخدمات الحكومية والعامة ومشاركة التجارب مع الآخرين.</p>
            <p class="fadeItem" style="opacity: 0;">يمكنك استعراض الخدمات، إضافة خدمات جديدة، وتقييم الخدمات بناءً على تجربتك الشخصية.</p>
            <p class="fadeItem" style="opacity: 0;">انضم إلينا الآن وكن جزءاً من مجتمعنا!</p>
            <button class="btn-start fadeItem" style="opacity: 0;" onclick="closeWelcomeModal()">ابدأ الآن</button>
        </div>
    </div>
    
    <script>
        // البيانات المخزنة محلياً
        let services = JSON.parse(localStorage.getItem('services')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentServiceId = null;
        let currentCategory = 'الكل';
        
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            updateStats();
            renderServices();
            
            // إعداد مستمعي الأحداث للنماذج
            document.getElementById('serviceForm').addEventListener('submit', handleServiceSubmit);
            document.getElementById('reviewForm').addEventListener('submit', handleReviewSubmit);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // البحث أثناء الكتابة
            document.getElementById('searchInput').addEventListener('input', function(e) {
                showSuggestions(e.target.value);
            });
            
            // إغلاق اقتراحات البحث عند النقر خارجها
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    document.getElementById('searchSuggestions').style.display = 'none';
                }
            });
            
            // تحميل نافذة الترحيب بعد تأخير بسيط
            setTimeout(() => {
                showWelcomeModal();
            }, 1000);
        });
        
        // تهيئة التطبيق
        function initApp() {
            // إذا لم يكن هناك مستخدمين، نضيف مستخدم افتراضي
            if (users.length === 0) {
                const defaultUser = {
                    id: 1,
                    name: "مستخدم تجريبي",
                    email: "test@example.com",
                    password: "123456"
                };
                users.push(defaultUser);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // إذا لم يكن هناك خدمات، نضيف بعض الخدمات الافتراضية
            if (services.length === 0) {
                const defaultServices = [
                    {
                        id: 1,
                        name: "استخراج جواز سفر",
                        category: "حكومي",
                        location: "مكتب الباسبور - القاهرة",
                        requiredDocs: "صورة بطاقة الرقم القومي، 4 صور شخصية، طلب استخراج جواز سفر",
                        cost: "400 جنيه",
                        duration: "7-10 أيام",
                        notes: "يجب الحضور شخصياً للتقديم",
                        userId: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: "تجديد رخصة قيادة",
                        category: "حكومي",
                        location: "إدارة المرور - الجيزة",
                        requiredDocs: "رخصة القيادة القديمة، صورة بطاقة الرقم القومي، نموذج طلب تجديد",
                        cost: "350 جنيه",
                        duration: "يوم واحد",
                        notes: "يجب إجراء الكشف الطبي أولاً",
                        userId: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: "الكشف في مستشفى التأمين الصحي",
                        category: "صحة",
                        location: "مستشفى التأمين الصحي - الإسكندرية",
                        requiredDocs: "بطاقة التأمين الصحي، تحويل من الطبيب",
                        cost: "10 جنيه (رسوم الكشف)",
                        duration: "يتم تحديد موعد مسبق",
                        notes: "يجب الحضور قبل الموعد بنصف ساعة على الأقل",
                        userId: 1,
                        createdAt: new Date().toISOString()
                    }
                ];
                services = defaultServices;
                localStorage.setItem('services', JSON.stringify(services));
            }
            
            // إذا لم يكن هناك تقييمات، نضيف بعض التقييمات الافتراضية
            if (reviews.length === 0) {
                const defaultReviews = [
                    {
                        id: 1,
                        serviceId: 1,
                        userId: 1,
                        rating: 4,
                        comment: "تجربة جيدة بشكل عام ولكن الانتظار طويل",
                        accuracy: "نعم",
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        serviceId: 2,
                        userId: 1,
                        rating: 5,
                        comment: "خدمة سريعة وممتازة، أنصح بالحضور مبكراً",
                        accuracy: "نعم",
                        createdAt: new Date().toISOString()
                    }
                ];
                reviews = defaultReviews;
                localStorage.setItem('reviews', JSON.stringify(reviews));
            }
            
            // تحديث واجهة المستخدم بناءً على حالة تسجيل الدخول
            updateUI();
            
            // إعداد نظام النجوم للتقييم
            setupRatingStars();
        }
        
        // إعداد نظام النجوم للتقييم
        function setupRatingStars() {
            const stars = document.querySelectorAll('#ratingStars i');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    setRating(rating);
                });
                
                star.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const rating = parseInt(this.getAttribute('data-rating'));
                        setRating(rating);
                    }
                });
            });
        }
        
        // تعيين التقييم
        function setRating(rating) {
            const stars = document.querySelectorAll('#ratingStars i');
            document.getElementById('reviewRating').value = rating;
            
            stars.forEach(star => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= rating) {
                    star.classList.remove('far');
                    star.classList.add('fas');
                    star.setAttribute('aria-checked', 'true');
                } else {
                    star.classList.remove('fas');
                    star.classList.add('far');
                    star.setAttribute('aria-checked', 'false');
                }
            });
        }
        
        // تحديث الإحصائيات
        function updateStats() {
            document.getElementById('statServices').textContent = services.length;
            document.getElementById('statUsers').textContent = users.length;
            document.getElementById('statReviews').textContent = reviews.length;
        }
        
        // تحديث واجهة المستخدم بناءً على حالة تسجيل الدخول
        function updateUI() {
            if (currentUser) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('registerBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-flex';
                document.getElementById('addServiceNav').style.display = 'inline-flex';
                document.getElementById('addServiceTop').style.display = 'inline-flex';
            } else {
                document.getElementById('loginBtn').style.display = 'inline-flex';
                document.getElementById('registerBtn').style.display = 'inline-flex';
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('addServiceNav').style.display = 'none';
                document.getElementById('addServiceTop').style.display = 'none';
            }
        }
        
        // عرض الخدمات
        function renderServices(filteredServices = null) {
            const servicesContainer = document.getElementById('services');
            const emptyElement = document.getElementById('empty');
            const servicesToRender = filteredServices || services;
            
            servicesContainer.innerHTML = '';
            
            if (servicesToRender.length === 0) {
                emptyElement.style.display = 'block';
                return;
            }
            
            emptyElement.style.display = 'none';
            
            servicesToRender.forEach(service => {
                const serviceReviews = reviews.filter(r => r.serviceId === service.id);
                const avgRating = serviceReviews.length > 0 
                    ? (serviceReviews.reduce((sum, review) => sum + review.rating, 0) / serviceReviews.length).toFixed(1)
                    : 0;
                
                const serviceElement = document.createElement('div');
                serviceElement.className = 'card';
                serviceElement.setAttribute('aria-label', `خدمة ${service.name}`);
                
                serviceElement.innerHTML = `
                    <h3>${service.name}</h3>
                    <div class="meta">
                        <span>📂 ${service.category}</span>
                        <span>📍 ${service.location}</span>
                    </div>
                    <div class="rating" aria-label="التقييم ${avgRating} من 5">
                        ${renderStars(avgRating)}
                        <span style="color:#777;margin-right:5px">(${serviceReviews.length})</span>
                    </div>
                    <p><strong>الأوراق المطلوبة:</strong> ${service.requiredDocs}</p>
                    ${service.cost ? `<p><strong>التكلفة:</strong> ${service.cost}</p>` : ''}
                    ${service.duration ? `<p><strong>المدة:</strong> ${service.duration}</p>` : ''}
                    ${service.notes ? `<p><strong>ملاحظات:</strong> ${service.notes}</p>` : ''}
                    <div class="card-actions">
                        <button class="btn btn-primary btn-icon card-action-btn" onclick="openReview(${service.id})" aria-label="تقييم الخدمة">
                            ⭐ تقييم
                        </button>
                        ${currentUser && currentUser.id === service.userId ? `
                            <button class="btn btn-warning btn-icon card-action-btn" onclick="editService(${service.id})" aria-label="تعديل الخدمة">
                                ✏️ تعديل
                            </button>
                            <button class="btn btn-danger btn-icon card-action-btn" onclick="deleteService(${service.id})" aria-label="حذف الخدمة">
                                🗑️ حذف
                            </button>
                        ` : ''}
                    </div>
                `;
                
                servicesContainer.appendChild(serviceElement);
            });
        }
        
        // عرض النجوم للتقييم
        function renderStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            
            return stars;
        }
        
        // البحث عن الخدمات
        function searchServices() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!query) {
                renderServices();
                document.getElementById('searchResultsInfo').textContent = '';
                return;
            }
            
            const searchTerms = query.split(' ');
            const filteredServices = services.filter(service => {
                const searchableText = `${service.name} ${service.category} ${service.location} ${service.requiredDocs} ${service.notes}`.toLowerCase();
                return searchTerms.every(term => searchableText.includes(term));
            });
            
            renderServices(filteredServices);
            
            // عرض معلومات نتائج البحث
            const resultsInfo = document.getElementById('searchResultsInfo');
            if (filteredServices.length === 0) {
                resultsInfo.textContent = `لم يتم العثور على نتائج لـ "${query}"`;
            } else {
                resultsInfo.textContent = `عرض ${filteredServices.length} نتيجة لـ "${query}"`;
            }
        }
        
        // عرض اقتراحات البحث
        function showSuggestions(query) {
            const suggestionsContainer = document.getElementById('searchSuggestions');
            
            if (!query) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            const searchTerms = query.toLowerCase().split(' ');
            const matchedServices = services.filter(service => {
                const searchableText = `${service.name} ${service.category} ${service.location}`.toLowerCase();
                return searchTerms.some(term => searchableText.includes(term));
            }).slice(0, 5);
            
            if (matchedServices.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            suggestionsContainer.innerHTML = '';
            matchedServices.forEach(service => {
                const suggestion = document.createElement('div');
                suggestion.className = 'search-suggestion';
                suggestion.textContent = `${service.name} - ${service.location}`;
                suggestion.addEventListener('click', () => {
                    document.getElementById('searchInput').value = service.name;
                    suggestionsContainer.style.display = 'none';
                    searchServices();
                });
                suggestionsContainer.appendChild(suggestion);
            });
            
            suggestionsContainer.style.display = 'block';
        }
        
        // التصفية حسب التصنيف
        function filterByCategory(category) {
            currentCategory = category;
            
            // تحديث أزرار التصنيفات النشطة
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            if (category === 'الكل') {
                renderServices();
                document.getElementById('searchResultsInfo').textContent = '';
            } else {
                const filteredServices = services.filter(service => service.category === category);
                renderServices(filteredServices);
                
                // عرض معلومات نتائج التصفية
                const resultsInfo = document.getElementById('searchResultsInfo');
                if (filteredServices.length === 0) {
                    resultsInfo.textContent = `لا توجد خدمات في قسم "${category}"`;
                } else {
                    resultsInfo.textContent = `عرض ${filteredServices.length} خدمة في قسم "${category}"`;
                }
            }
        }
        
        // فتح/إغلاق نموذج إضافة خدمة
        function toggleAdd(editId = null) {
            const modal = document.getElementById('addModal');
            
            if (modal.classList.contains('active')) {
                modal.classList.remove('active');
                document.getElementById('serviceForm').reset();
                document.getElementById('editServiceId').value = '';
            } else {
                modal.classList.add('active');
                
                if (editId) {
                    document.getElementById('addModalTitle').textContent = 'تعديل الخدمة';
                    const service = services.find(s => s.id === editId);
                    if (service) {
                        document.getElementById('editServiceId').value = service.id;
                        document.getElementById('svcName').value = service.name;
                        document.getElementById('svcCat').value = service.category;
                        document.getElementById('svcLoc').value = service.location;
                        document.getElementById('svcDocs').value = service.requiredDocs;
                        document.getElementById('svcCost').value = service.cost || '';
                        document.getElementById('svcDur').value = service.duration || '';
                        document.getElementById('svcNotes').value = service.notes || '';
                    }
                } else {
                    document.getElementById('addModalTitle').textContent = 'إضافة خدمة جديدة';
                }
            }
        }
        
        // معالجة إرسال نموذج الخدمة
        function handleServiceSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('يجب تسجيل الدخول أولاً', 'error');
                toggleAdd();
                openAuth('login');
                return;
            }
            
            const serviceId = document.getElementById('editServiceId').value;
            const serviceData = {
                name: document.getElementById('svcName').value,
                category: document.getElementById('svcCat').value,
                location: document.getElementById('svcLoc').value,
                requiredDocs: document.getElementById('svcDocs').value,
                cost: document.getElementById('svcCost').value,
                duration: document.getElementById('svcDur').value,
                notes: document.getElementById('svcNotes').value,
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            if (serviceId) {
                // تعديل خدمة موجودة
                const index = services.findIndex(s => s.id === parseInt(serviceId));
                if (index !== -1) {
                    // الحفاظ على تاريخ الإنشاء الأصلي
                    serviceData.createdAt = services[index].createdAt;
                    serviceData.id = parseInt(serviceId);
                    services[index] = serviceData;
                    showToast('تم تعديل الخدمة بنجاح', 'success');
                }
            } else {
                // إضافة خدمة جديدة
                serviceData.id = services.length > 0 ? Math.max(...services.map(s => s.id)) + 1 : 1;
                services.push(serviceData);
                showToast('تم إضافة الخدمة بنجاح', 'success');
            }
            
            localStorage.setItem('services', JSON.stringify(services));
            updateStats();
            renderServices();
            toggleAdd();
        }
        
        // تعديل خدمة
        function editService(id) {
            if (!currentUser) {
                showToast('يجب تسجيل الدخول أولاً', 'error');
                openAuth('login');
                return;
            }
            
            const service = services.find(s => s.id === id);
            if (service.userId !== currentUser.id) {
                showToast('لا يمكنك تعديل هذه الخدمة', 'error');
                return;
            }
            
            toggleAdd(id);
        }
        
        // حذف خدمة
        function deleteService(id) {
            if (!currentUser) {
                showToast('يجب تسجيل الدخول أولاً', 'error');
                openAuth('login');
                return;
            }
            
            const service = services.find(s => s.id === id);
            if (!service) return;
            
            if (service.userId !== currentUser.id) {
                showToast('لا يمكنك حذف هذه الخدمة', 'error');
                return;
            }
            
            if (!confirm('هل أنت متأكد من حذف هذه الخدمة؟ سيتم حذف جميع التقييمات المرتبطة بها.')) {
                return;
            }
            
            // حذف الخدمة والتقييمات المرتبطة بها
            services = services.filter(s => s.id !== id);
            reviews = reviews.filter(r => r.serviceId !== id);
            
            localStorage.setItem('services', JSON.stringify(services));
            localStorage.setItem('reviews', JSON.stringify(reviews));
            
            updateStats();
            renderServices();
            showToast('تم حذف الخدمة بنجاح', 'success');
        }
        
        // فتح نافذة التقييم
        function openReview(serviceId) {
            if (!currentUser) {
                showToast('يجب تسجيل الدخول أولاً', 'error');
                openAuth('login');
                return;
            }
            
            currentServiceId = serviceId;
            const service = services.find(s => s.id === serviceId);
            if (!service) return;
            
            document.getElementById('reviewServiceName').textContent = service.name;
            document.getElementById('reviewModal').classList.add('active');
            document.getElementById('reviewForm').reset();
            setRating(0);
            
            // تحميل التقييمات الحالية للخدمة
            loadServiceReviews(serviceId);
        }
        
        // إغلاق نافذة التقييم
        function closeReview() {
            document.getElementById('reviewModal').classList.remove('active');
            currentServiceId = null;
        }
        
        // تحميل تقييمات الخدمة
        function loadServiceReviews(serviceId) {
            const reviewsList = document.getElementById('reviewsList');
            const serviceReviews = reviews.filter(r => r.serviceId === serviceId);
            
            if (serviceReviews.length === 0) {
                reviewsList.innerHTML = '<p>لا توجد تقييمات لهذه الخدمة بعد.</p>';
                return;
            }
            
            reviewsList.innerHTML = '';
            serviceReviews.forEach(review => {
                const user = users.find(u => u.id === review.userId);
                const reviewElement = document.createElement('div');
                reviewElement.className = 'review-item';
                
                reviewElement.innerHTML = `
                    <div class="review-header">
                        <div>${user ? user.name : 'مستخدم مجهول'}</div>
                        <div class="rating">${renderStars(review.rating)}</div>
                    </div>
                    <div class="review-accuracy">دقة المعلومات: ${review.accuracy}</div>
                    ${review.comment ? `<div class="review-comment">${review.comment}</div>` : ''}
                `;
                
                reviewsList.appendChild(reviewElement);
            });
        }
        
        // معالجة إرسال نموذج التقييم
        function handleReviewSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('يجب تسجيل الدخول أولاً', 'error');
                closeReview();
                openAuth('login');
                return;
            }
            
            const rating = parseInt(document.getElementById('reviewRating').value);
            const comment = document.getElementById('reviewComment').value;
            const accuracy = document.getElementById('reviewAccuracy').value;
            
            if (rating === 0) {
                showToast('يرجى اختيار تقييم', 'error');
                return;
            }
            
            if (!accuracy) {
                showToast('يرجى تحديد ما إذا كانت المعلومات صحيحة', 'error');
                return;
            }
            
            // التحقق مما إذا كان المستخدم قد قام بتقييم هذه الخدمة من قبل
            const existingReviewIndex = reviews.findIndex(r => 
                r.serviceId === currentServiceId && r.userId === currentUser.id
            );
            
            const reviewData = {
                id: existingReviewIndex !== -1 ? reviews[existingReviewIndex].id : reviews.length > 0 ? Math.max(...reviews.map(r => r.id)) + 1 : 1,
                serviceId: currentServiceId,
                userId: currentUser.id,
                rating: rating,
                comment: comment,
                accuracy: accuracy,
                createdAt: new Date().toISOString()
            };
            
            if (existingReviewIndex !== -1) {
                // تحديث التقييم الحالي
                reviews[existingReviewIndex] = reviewData;
                showToast('تم تحديث تقييمك بنجاح', 'success');
            } else {
                // إضافة تقييم جديد
                reviews.push(reviewData);
                showToast('تم إضافة تقييمك بنجاح', 'success');
            }
            
            localStorage.setItem('reviews', JSON.stringify(reviews));
            updateStats();
            loadServiceReviews(currentServiceId);
            document.getElementById('reviewForm').reset();
            setRating(0);
            
            // إعادة عرض الخدمات لتحديث التقييمات
            renderServices();
        }
        
        // فتح نافذة المصادقة
        function openAuth(type) {
            document.getElementById('authModal').classList.add('active');
            
            if (type === 'login') {
                document.getElementById('authTitle').textContent = 'تسجيل الدخول';
                document.getElementById('loginForm').style.display = 'grid';
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('toggleAuthBtn').textContent = 'ليس لديك حساب؟ إنشاء حساب';
            } else {
                document.getElementById('authTitle').textContent = 'إنشاء حساب';
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'grid';
                document.getElementById('toggleAuthBtn').textContent = 'لديك حساب بالفعل؟ تسجيل الدخول';
            }
        }
        
        // إغلاق نافذة المصادقة
        function closeAuth() {
            document.getElementById('authModal').classList.remove('active');
        }
        
        // التبديل بين نماذج المصادقة
        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (loginForm.style.display === 'none') {
                document.getElementById('authTitle').textContent = 'تسجيل الدخول';
                loginForm.style.display = 'grid';
                registerForm.style.display = 'none';
                document.getElementById('toggleAuthBtn').textContent = 'ليس لديك حساب؟ إنشاء حساب';
            } else {
                document.getElementById('authTitle').textContent = 'إنشاء حساب';
                loginForm.style.display = 'none';
                registerForm.style.display = 'grid';
                document.getElementById('toggleAuthBtn').textContent = 'لديك حساب بالفعل؟ تسجيل الدخول';
            }
        }
        
        // معالجة تسجيل الدخول
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUI();
                closeAuth();
                showToast(`مرحباً بعودتك، ${user.name}`, 'success');
            } else {
                showToast('البريد الإلكتروني أو كلمة المرور غير صحيحة', 'error');
            }
        }
        
        // معالجة إنشاء حساب
        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            // التحقق من وجود المستخدم مسبقاً
            if (users.some(u => u.email === email)) {
                showToast('هذا البريد الإلكتروني مستخدم بالفعل', 'error');
                return;
            }
            
            const newUser = {
                id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                name: name,
                email: email,
                password: password
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            updateUI();
            closeAuth();
            showToast(`تم إنشاء حسابك بنجاح، مرحباً بك ${name}`, 'success');
        }
        
        // تسجيل الخروج
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUI();
            showToast('تم تسجيل الخروج بنجاح', 'success');
        }
        
        // عرض الإشعارات
        function showToast(message, type = 'default') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            const toastWrap = document.getElementById('toastWrap');
            toastWrap.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // عرض نافذة الترحيب
        function showWelcomeModal() {
            const welcomeModal = document.getElementById('welcomeModal');
            welcomeModal.style.display = 'flex';
            
            // عرض العناصر بشكل متتابع
            const fadeItems = document.querySelectorAll('.fadeItem');
            fadeItems.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('show');
                }, 300 * (index + 1));
            });
        }
        
        // إغلاق نافذة الترحيب
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').style.display = 'none';
        }
    </script>
</body>
</html>
