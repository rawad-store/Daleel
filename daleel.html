<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¯Ù„ÙŠÙ„ - Daleel</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #2D5F7C;
      --secondary-color: #FF9800;
      --accent-color: #4CAF50;
      --light-color: #f5f7f9;
      --dark-color: #333;
      --gray-color: #e0e0e0;
      --danger-color: #f44336;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body { 
      font-family: 'Cairo', sans-serif; 
      background: var(--light-color); 
      margin: 0; 
      padding: 0; 
      color: var(--dark-color);
      line-height: 1.6;
    }
    
    header { 
      background: var(--primary-color); 
      color: white; 
      padding: 15px; 
      text-align: center;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .container { 
      max-width: 1000px; 
      margin: auto; 
      padding: 20px; 
    }
    
    .service-card { 
      background: white; 
      padding: 20px; 
      margin: 15px 0; 
      border-radius: 8px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .service-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .verified { 
      color: var(--accent-color); 
      font-weight: bold; 
    }
    
    .pending { 
      color: var(--secondary-color); 
      font-weight: bold; 
    }
    
    .vote-btn { 
      border: none; 
      background: none; 
      cursor: pointer; 
      font-size: 1.2rem; 
      margin: 0 5px; 
      transition: transform 0.2s;
    }
    
    .vote-btn:hover {
      transform: scale(1.2);
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: #1e4660;
    }
    
    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }
    
    .btn-secondary:hover {
      background: #e68900;
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }
    
    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .auth-form, .service-form { 
      display: none; 
      margin-bottom: 20px; 
      background: white; 
      padding: 20px; 
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    input, textarea, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid var(--gray-color);
      border-radius: 6px;
      font-family: 'Cairo', sans-serif;
    }
    
    .user-info {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-info span {
      margin-right: 10px;
    }
    
    .filters {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .filter-select {
      flex: 1;
      min-width: 150px;
    }
    
    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .service-meta {
      display: flex;
      gap: 15px;
      margin: 10px 0;
      flex-wrap: wrap;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: var(--primary-color);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #777;
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--gray-color);
    }
    
    @media (max-width: 768px) {
      .user-info {
        position: static;
        transform: none;
        justify-content: center;
        margin-top: 10px;
      }
      
      .filters {
        flex-direction: column;
      }
      
      .service-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“ Ø¯Ù„ÙŠÙ„ - Daleel</h1>
    <div class="user-info" id="userInfo" style="display: none;">
      <span id="userEmail"></span>
      <button class="btn btn-outline" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <div class="container">
    <!-- Auth Section -->
    <div id="authSection">
      <div style="text-align: center; margin: 20px 0;">
        <button class="btn btn-primary" onclick="showForm('loginForm')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button class="btn btn-secondary" onclick="showForm('registerForm')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      </div>

      <form id="loginForm" class="auth-form">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
        <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Ø¯Ø®ÙˆÙ„</button>
      </form>

      <form id="registerForm" class="auth-form">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
        <input type="email" id="registerEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        <input type="password" id="registerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)" required>
        <button type="submit" class="btn btn-primary" style="width: 100%;">ØªØ³Ø¬ÙŠÙ„</button>
      </form>
    </div>

    <div id="mainContent" style="display: none;">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
        <button class="btn btn-secondary" onclick="toggleAddForm()">
          <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
        
        <div class="filters">
          <select class="filter-select" id="categoryFilter" onchange="loadServices()">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
            <option value="Ø­ÙƒÙˆÙ…ÙŠ">Ø­ÙƒÙˆÙ…ÙŠ</option>
            <option value="ØµØ­Ø©">ØµØ­Ø©</option>
            <option value="ØªØ¹Ù„ÙŠÙ…">ØªØ¹Ù„ÙŠÙ…</option>
            <option value="Ù…ÙˆØ§ØµÙ„Ø§Øª">Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
          </select>
          
          <select class="filter-select" id="sortBy" onchange="loadServices()">
            <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
            <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
            <option value="mostVoted">Ø§Ù„Ø£ÙƒØ«Ø± ØªØµÙˆÙŠØªØ§Ù‹</option>
            <option value="leastVoted">Ø§Ù„Ø£Ù‚Ù„ ØªØµÙˆÙŠØªØ§Ù‹</option>
          </select>
        </div>
      </div>

      <!-- Add Service Form -->
      <form id="serviceForm" class="service-form">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <input type="text" id="serviceName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø©" required>
        <select id="serviceCategory" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          <option value="Ø­ÙƒÙˆÙ…ÙŠ">Ø­ÙƒÙˆÙ…ÙŠ</option>
          <option value="ØµØ­Ø©">ØµØ­Ø©</option>
          <option value="ØªØ¹Ù„ÙŠÙ…">ØªØ¹Ù„ÙŠÙ…</option>
          <option value="Ù…ÙˆØ§ØµÙ„Ø§Øª">Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
          <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
        </select>
        <input type="text" id="serviceLocation" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†" required>
        <textarea id="serviceDocuments" placeholder="Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©" required></textarea>
        <input type="text" id="serviceCost" placeholder="Ø§Ù„ØªÙƒÙ„ÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <input type="text" id="serviceDuration" placeholder="Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø©</button>
          <button type="button" class="btn btn-outline" onclick="toggleAddForm()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>

      <!-- Services List -->
      <div id="servicesContainer">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase v8 SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <script>
    // ğŸ”§ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù…Ù† Firebase (Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©)
    const firebaseConfig = {
      apiKey: "AIzaSyB6TzN-QHVUOwizABYxmQY8fkqTp1qb_qA",
      authDomain: "daleel-c4204.firebaseapp.com",
      projectId: "daleel-c4204",
      storageBucket: "daleel-c4204.firebasestorage.app",
      messagingSenderId: "864882936232",
      appId: "1:864882936232:web:5bfc14da7c035ff025b59d",
      measurementId: "G-3ZFEC0TE93"
    };

    // âœ… Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const servicesContainer = document.getElementById("servicesContainer");
    const serviceForm = document.getElementById("serviceForm");
    const authSection = document.getElementById("authSection");
    const mainContent = document.getElementById("mainContent");
    const userInfo = document.getElementById("userInfo");
    const userEmail = document.getElementById("userEmail");

    // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let currentUser = null;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    function initApp() {
      // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          currentUser = user;
          userEmail.textContent = user.email;
          userInfo.style.display = 'flex';
          authSection.style.display = 'none';
          mainContent.style.display = 'block';
          await loadServices();
        } else {
          currentUser = null;
          userInfo.style.display = 'none';
          authSection.style.display = 'block';
          mainContent.style.display = 'none';
        }
      });
    }

    // Toggle Add Form
    function toggleAddForm() {
      serviceForm.style.display = serviceForm.style.display === "none" ? "block" : "none";
    }

    // Show Auth Forms
    function showForm(formId) {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("registerForm").style.display = "none";
      document.getElementById(formId).style.display = "block";
    }

    // Register
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("registerEmail").value;
      const password = document.getElementById("registerPassword").value;
      
      if (password.length < 6) {
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
        return;
      }
      
      try {
        await auth.createUserWithEmailAndPassword(email, password);
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…");
        document.getElementById("registerForm").reset();
      } catch (err) { 
        alert(err.message); 
      }
    });

    // Login
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      try {
        await auth.signInWithEmailAndPassword(email, password);
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
        document.getElementById("loginForm").reset();
      } catch (err) { 
        alert(err.message); 
      }
    });

    // Logout
    function logout() {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
        auth.signOut();
      }
    }

    // Add Service
    serviceForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      if (!currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      
      const serviceData = {
        name: document.getElementById("serviceName").value,
        category: document.getElementById("serviceCategory").value,
        location: document.getElementById("serviceLocation").value,
        documents: document.getElementById("serviceDocuments").value,
        cost: document.getElementById("serviceCost").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯",
        duration: document.getElementById("serviceDuration").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©",
        createdAt: new Date(),
        votes: 0,
        verified: false,
        userId: currentUser.uid
      };
      
      try {
        await db.collection("services").add(serviceData);
        alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø© âœ…");
        serviceForm.reset();
        toggleAddForm();
        await loadServices();
      } catch (err) { 
        console.error(err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø©");
      }
    });

    // Load Services
    async function loadServices() {
      servicesContainer.innerHTML = `
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...</p>
        </div>
      `;
      
      try {
        const categoryFilter = document.getElementById("categoryFilter").value;
        const sortBy = document.getElementById("sortBy").value;
        
        let query = db.collection("services");
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
        if (categoryFilter) {
          query = query.where("category", "==", categoryFilter);
        }
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨
        switch(sortBy) {
          case "newest":
            query = query.orderBy("createdAt", "desc");
            break;
          case "oldest":
            query = query.orderBy("createdAt", "asc");
            break;
          case "mostVoted":
            query = query.orderBy("votes", "desc");
            break;
          case "leastVoted":
            query = query.orderBy("votes", "asc");
            break;
          default:
            query = query.orderBy("createdAt", "desc");
        }
        
        const snapshot = await query.get();
        
        if (snapshot.empty) {
          servicesContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-inbox"></i>
              <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</h3>
              <p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¶ÙŠÙ Ø®Ø¯Ù…Ø©!</p>
            </div>
          `;
          return;
        }
        
        servicesContainer.innerHTML = "";
        snapshot.forEach(doc => {
          const s = doc.data();
          const card = document.createElement("div");
          card.className = "service-card";
          card.innerHTML = `
            <div class="service-header">
              <h3>${s.name}</h3>
              <span class="${s.verified ? 'verified' : 'pending'}">
                <i class="fas ${s.verified ? 'fa-check-circle' : 'fa-clock'}"></i>
                ${s.verified ? 'Ù…ÙˆØ«ÙˆÙ‚' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
              </span>
            </div>
            
            <div class="service-meta">
              <div class="meta-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>${s.location}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-folder"></i>
                <span>${s.category}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-money-bill-wave"></i>
                <span>${s.cost}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>${s.duration}</span>
              </div>
            </div>
            
            <div style="margin: 15px 0;">
              <p><b>Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</b></p>
              <p>${s.documents}</p>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
              <div>
                <button class="vote-btn" onclick="vote('${doc.id}', 1)">
                  <i class="fas fa-thumbs-up"></i>
                </button>
                <span>${s.votes}</span>
                <button class="vote-btn" onclick="vote('${doc.id}', -1)">
                  <i class="fas fa-thumbs-down"></i>
                </button>
              </div>
              
              <small>${formatDate(s.createdAt)}</small>
            </div>
          `;
          servicesContainer.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        servicesContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-circle"></i>
            <h3>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
          </div>
        `;
      }
    }

    // Voting
    async function vote(id, value) {
      if (!currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ØªØµÙˆÙŠØª");
        return;
      }
      
      try {
        const ref = db.collection("services").doc(id);
        await ref.update({ votes: firebase.firestore.FieldValue.increment(value) });
        await loadServices();
      } catch (err) {
        console.error(err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª");
      }
    }

    // Format Date
    function formatDate(timestamp) {
      if (!timestamp) return "";
      
      const date = timestamp.toDate();
      return new Intl.DateTimeFormat('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }).format(date);
    }

    // Initialize the app
    initApp();
  </script>
</body>
</html>
