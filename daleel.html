<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¯Ù„ÙŠÙ„ - Daleel</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #2D5F7C;
      --secondary-color: #FF9800;
      --accent-color: #4CAF50;
      --light-color: #f5f7f9;
      --dark-color: #333;
      --gray-color: #e0e0e0;
      --danger-color: #f44336;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body { 
      font-family: 'Cairo', sans-serif; 
      background: var(--light-color); 
      margin: 0; 
      padding: 0; 
      color: var(--dark-color);
      line-height: 1.6;
    }
    
    header { 
      background: var(--primary-color); 
      color: white; 
      padding: 15px; 
      text-align: center;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .container { 
      max-width: 1000px; 
      margin: auto; 
      padding: 20px; 
    }
    
    .service-card { 
      background: white; 
      padding: 20px; 
      margin: 15px 0; 
      border-radius: 8px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .service-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .verified { 
      color: var(--accent-color); 
      font-weight: bold; 
    }
    
    .pending { 
      color: var(--secondary-color); 
      font-weight: bold; 
    }
    
    .vote-btn { 
      border: none; 
      background: none; 
      cursor: pointer; 
      font-size: 1.2rem; 
      margin: 0 5px; 
      transition: transform 0.2s;
    }
    
    .vote-btn:hover {
      transform: scale(1.2);
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: #1e4660;
    }
    
    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }
    
    .btn-secondary:hover {
      background: #e68900;
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }
    
    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .auth-form, .service-form { 
      display: none; 
      margin-bottom: 20px; 
      background: white; 
      padding: 20px; 
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    input, textarea, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid var(--gray-color);
      border-radius: 6px;
      font-family: 'Cairo', sans-serif;
    }
    
    .user-info {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-info span {
      margin-right: 10px;
    }
    
    .filters {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .filter-select {
      flex: 1;
      min-width: 150px;
    }
    
    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .service-meta {
      display: flex;
      gap: 15px;
      margin: 10px 0;
      flex-wrap: wrap;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: var(--primary-color);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #777;
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--gray-color);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 5px;
      color: white;
      z-index: 1000;
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.3s, transform 0.3s;
      max-width: 400px;
    }
    
    .notification.success {
      background-color: var(--accent-color);
      opacity: 1;
      transform: translateY(0);
    }
    
    .notification.error {
      background-color: var(--danger-color);
      opacity: 1;
      transform: translateY(0);
    }
    
    .help-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .help-step {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--gray-color);
    }
    
    .help-step:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    @media (max-width: 768px) {
      .user-info {
        position: static;
        transform: none;
        justify-content: center;
        margin-top: 10px;
      }
      
      .filters {
        flex-direction: column;
      }
      
      .service-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .notification {
        left: 20px;
        right: 20px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“ Ø¯Ù„ÙŠÙ„ - Daleel</h1>
    <div class="user-info" id="userInfo" style="display: none;">
      <span id="userEmail"></span>
      <button class="btn btn-outline" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <div id="notification" class="notification"></div>

  <div class="container">
    <!-- Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥ØµÙ„Ø§Ø­ Firebase -->
    <div class="help-box" id="firebaseHelp" style="display: none;">
      <h2>Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Firebase</h2>
      <div class="help-step">
        <h3>Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase</h3>
        <p>1. Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></p>
        <p>2. Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹ "daleel-c4204"</p>
        <p>3. Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (âš™ï¸) â†’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</p>
      </div>
      <div class="help-step">
        <h3>Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ†</h3>
        <p>1. Ø§Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ† Ù…Ù† Ù‚Ø³Ù… "ØªØ·Ø¨ÙŠÙ‚Ø§ØªÙƒ"</p>
        <p>2. Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ† ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
      </div>
      <div class="help-step">
        <h3>Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªÙ…ÙƒÙŠÙ† Ø®Ø¯Ù…Ø§Øª Firebase</h3>
        <p>1. ÙÙŠ Authentication â†’ Sign-in methodØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ…ÙƒÙŠÙ† "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ/ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"</p>
        <p>2. ÙÙŠ Firestore DatabaseØŒ Ø£Ù†Ø´Ø¦ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©</p>
      </div>
    </div>

    <!-- Auth Section -->
    <div id="authSection">
      <div style="text-align: center; margin: 20px 0;">
        <button class="btn btn-primary" onclick="showForm('loginForm')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button class="btn btn-secondary" onclick="showForm('registerForm')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      </div>

      <form id="loginForm" class="auth-form">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
        <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Ø¯Ø®ÙˆÙ„</button>
      </form>

      <form id="registerForm" class="auth-form">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
        <input type="email" id="registerEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        <input type="password" id="registerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)" required>
        <button type="submit" class="btn btn-primary" style="width: 100%;">ØªØ³Ø¬ÙŠÙ„</button>
      </form>
    </div>

    <div id="mainContent" style="display: none;">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
        <button class="btn btn-secondary" onclick="toggleAddForm()">
          <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
        
        <div class="filters">
          <select class="filter-select" id="categoryFilter" onchange="loadServices()">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
            <option value="Ø­ÙƒÙˆÙ…ÙŠ">Ø­ÙƒÙˆÙ…ÙŠ</option>
            <option value="ØµØ­Ø©">ØµØ­Ø©</option>
            <option value="ØªØ¹Ù„ÙŠÙ…">ØªØ¹Ù„ÙŠÙ…</option>
            <option value="Ù…ÙˆØ§ØµÙ„Ø§Øª">Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
          </select>
          
          <select class="filter-select" id="sortBy" onchange="loadServices()">
            <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
            <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
            <option value="mostVoted">Ø§Ù„Ø£ÙƒØ«Ø± ØªØµÙˆÙŠØªØ§Ù‹</option>
            <option value="leastVoted">Ø§Ù„Ø£Ù‚Ù„ ØªØµÙˆÙŠØªØ§Ù‹</option>
          </select>
        </div>
      </div>

      <!-- Add Service Form -->
      <form id="serviceForm" class="service-form">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <input type="text" id="serviceName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø©" required>
        <select id="serviceCategory" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          <option value="Ø­ÙƒÙˆÙ…ÙŠ">Ø­ÙƒÙˆÙ…ÙŠ</option>
          <option value="ØµØ­Ø©">ØµØ­Ø©</option>
          <option value="ØªØ¹Ù„ÙŠÙ…">ØªØ¹Ù„ÙŠÙ…</option>
          <option value="Ù…ÙˆØ§ØµÙ„Ø§Øª">Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
          <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
        </select>
        <input type="text" id="serviceLocation" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†" required>
        <textarea id="serviceDocuments" placeholder="Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©" required></textarea>
        <input type="text" id="serviceCost" placeholder="Ø§Ù„ØªÙƒÙ„ÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <input type="text" id="serviceDuration" placeholder="Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø©</button>
          <button type="button" class="btn btn-outline" onclick="toggleAddForm()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>

      <!-- Services List -->
      <div id="servicesContainer">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase v9 SDK -->
  <script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ¸Ø§Ø¦Ù Firebase Ø§Ù„ØªÙŠ Ù†Ø­ØªØ§Ø¬Ù‡Ø§
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, orderBy, query, where, increment } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    // ğŸ”§ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù…Ù† Firebase - Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase Console
    const firebaseConfig = {
      apiKey: "AIzaSyB6TzN-QHVUOwizABYxmQY8fkqTp1qb_qA",
      authDomain: "daleel-c4204.firebaseapp.com",
      projectId: "daleel-c4204",
      storageBucket: "daleel-c4204.firebasestorage.app",
      messagingSenderId: "864882936232",
      appId: "1:864882936232:web:5bfc14da7c035ff025b59d",
      measurementId: "G-3ZFEC0TE93"
    };

    // âœ… ØªÙ‡ÙŠØ¦Ø© Firebase
    let app;
    let db;
    let auth;

    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      auth = getAuth(app);
      
      // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥Ø°Ø§ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­
      document.getElementById('firebaseHelp').style.display = 'none';
    } catch (error) {
      console.error("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:", error);
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
      document.getElementById('firebaseHelp').style.display = 'block';
      showNotification("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.", false);
    }

    const servicesContainer = document.getElementById("servicesContainer");
    const serviceForm = document.getElementById("serviceForm");
    const authSection = document.getElementById("authSection");
    const mainContent = document.getElementById("mainContent");
    const userInfo = document.getElementById("userInfo");
    const userEmail = document.getElementById("userEmail");
    const notification = document.getElementById("notification");

    // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let currentUser = null;

    // ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, isSuccess = true) {
      notification.textContent = message;
      notification.className = isSuccess ? 'notification success' : 'notification error';
      
      setTimeout(() => {
        notification.className = 'notification';
      }, 3000);
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    function initApp() {
      if (!auth) {
        showNotification("Ù„Ù… ÙŠØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­", false);
        return;
      }

      // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUser = user;
          userEmail.textContent = user.email;
          userInfo.style.display = 'flex';
          authSection.style.display = 'none';
          mainContent.style.display = 'block';
          await loadServices();
        } else {
          currentUser = null;
          userInfo.style.display = 'none';
          authSection.style.display = 'block';
          mainContent.style.display = 'none';
        }
      });
    }

    // Toggle Add Form
    function toggleAddForm() {
      serviceForm.style.display = serviceForm.style.display === "none" ? "block" : "none";
    }

    // Show Auth Forms
    function showForm(formId) {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("registerForm").style.display = "none";
      document.getElementById(formId).style.display = "block";
    }

    // Register
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("registerEmail").value;
      const password = document.getElementById("registerPassword").value;
      
      if (password.length < 6) {
        showNotification("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", false);
        return;
      }
      
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        showNotification("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        document.getElementById("registerForm").reset();
      } catch (err) { 
        showNotification(err.message, false);
      }
    });

    // Login
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        showNotification("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        document.getElementById("loginForm").reset();
      } catch (err) { 
        showNotification(err.message, false);
      }
    });

    // Logout
    function logout() {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
        signOut(auth);
      }
    }

    // Add Service
    serviceForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      if (!currentUser) {
        showNotification("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹", false);
        return;
      }
      
      const serviceData = {
        name: document.getElementById("serviceName").value,
        category: document.getElementById("serviceCategory").value,
        location: document.getElementById("serviceLocation").value,
        documents: document.getElementById("serviceDocuments").value,
        cost: document.getElementById("serviceCost").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯",
        duration: document.getElementById("serviceDuration").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©",
        createdAt: new Date(),
        votes: 0,
        verified: false,
        userId: currentUser.uid
      };
      
      try {
        await addDoc(collection(db, "services"), serviceData);
        showNotification("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        serviceForm.reset();
        toggleAddForm();
        await loadServices();
      } catch (err) { 
        console.error(err);
        showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø©", false);
      }
    });

    // Load Services
    async function loadServices() {
      servicesContainer.innerHTML = `
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...</p>
        </div>
      `;
      
      try {
        const categoryFilter = document.getElementById("categoryFilter").value;
        const sortBy = document.getElementById("sortBy").value;
        
        let q;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        if (categoryFilter) {
          q = query(collection(db, "services"), where("category", "==", categoryFilter));
        } else {
          q = query(collection(db, "services"));
        }
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨
        switch(sortBy) {
          case "newest":
            q = query(q, orderBy("createdAt", "desc"));
            break;
          case "oldest":
            q = query(q, orderBy("createdAt", "asc"));
            break;
          case "mostVoted":
            q = query(q, orderBy("votes", "desc"));
            break;
          case "leastVoted":
            q = query(q, orderBy("votes", "asc"));
            break;
          default:
            q = query(q, orderBy("createdAt", "desc"));
        }
        
        const snapshot = await getDocs(q);
        
        if (snapshot.empty) {
          servicesContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-inbox"></i>
              <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</h3>
              <p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¶ÙŠÙ Ø®Ø¯Ù…Ø©!</p>
            </div>
          `;
          return;
        }
        
        servicesContainer.innerHTML = "";
        snapshot.forEach(doc => {
          const s = doc.data();
          const card = document.createElement("div");
          card.className = "service-card";
          card.innerHTML = `
            <div class="service-header">
              <h3>${s.name}</h3>
              <span class="${s.verified ? 'verified' : 'pending'}">
                <i class="fas ${s.verified ? 'fa-check-circle' : 'fa-clock'}"></i>
                ${s.verified ? 'Ù…ÙˆØ«ÙˆÙ‚' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
              </span>
            </div>
            
            <div class="service-meta">
              <div class="meta-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>${s.location}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-folder"></i>
                <span>${s.category}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-money-bill-wave"></i>
                <span>${s.cost}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>${s.duration}</span>
              </div>
            </div>
            
            <div style="margin: 15px 0;">
              <p><b>Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</b></p>
              <p>${s.documents}</p>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
              <div>
                <button class="vote-btn" onclick="vote('${doc.id}', 1)">
                  <i class="fas fa-thumbs-up"></i>
                </button>
                <span>${s.votes}</span>
                <button class="vote-btn" onclick="vote('${doc.id}', -1)">
                  <i class="fas fa-thumbs-down"></i>
                </button>
              </div>
              
              <small>${formatDate(s.createdAt)}</small>
            </div>
          `;
          servicesContainer.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        servicesContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-circle"></i>
            <h3>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
          </div>
        `;
      }
    }

    // Voting
    async function vote(id, value) {
      if (!currentUser) {
        showNotification("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ØªØµÙˆÙŠØª", false);
        return;
      }
      
      try {
        const serviceRef = doc(db, "services", id);
        await updateDoc(serviceRef, {
          votes: increment(value)
        });
        
        await loadServices();
      } catch (err) {
        console.error(err);
        showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª", false);
      }
    }

    // Format Date
    function formatDate(timestamp) {
      if (!timestamp) return "";
      
      const date = timestamp.toDate();
      return new Intl.DateTimeFormat('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }).format(date);
    }

    // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙÙŠ HTML
    window.toggleAddForm = toggleAddForm;
    window.showForm = showForm;
    window.logout = logout;
    window.vote = vote;
    window.loadServices = loadServices;

    // Initialize the app
    if (app && auth) {
      initApp();
    }
  </script>
</body>
</html>
